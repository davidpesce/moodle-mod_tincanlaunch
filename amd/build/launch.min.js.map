{"version":3,"sources":["../src/launch.js"],"names":["define","$","Str","SELECTORS","ATTEMPT_PROGRESS","ATTEMPT_TABLE","COMPLETION_CHECK","EXIT","LAUNCH_FORM","MAINCONTENT","NEW_ATTEMPT","NEW_ATTEMPT_LINK","REATTEMPT","REGISTRATION","STATUS","STATUSPARA","init","self","urlparams","URLSearchParams","window","location","search","id","get","n","each","registrationid","attr","substring","keyup","e","keyTest","keyCode","click","launchExperience","newregistrationid","setInterval","load","keycode","val","submit","remove","get_strings","key","component","done","s","text","exitpara","html","after"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handles display of the launch attempt table (registrations).\n *\n * @package   mod_tincanlaunch\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    David Pesce  (david.pesce [at] exputo [dt] com)\n\n * @module mod_tincanlaunch/launch\n*/\n\ndefine(['jquery', 'core/str'], function($, Str) {\n\n    var id = '';\n    var n = '';\n\n    var SELECTORS = {\n        ATTEMPT_PROGRESS: '#tincanlaunch_attemptprogress',\n        ATTEMPT_TABLE: '#tincanlaunch_attempttable',\n        COMPLETION_CHECK: '#tincanlaunch_completioncheck',\n        EXIT: '#tincanlaunch_exit',\n        LAUNCH_FORM: '#launchform',\n        MAINCONTENT: '#maincontent',\n        NEW_ATTEMPT: '#tincanlaunch_newattempt',\n        NEW_ATTEMPT_LINK: '[id^=tincanlaunch_newattemptlink-]',\n        REATTEMPT: '[id^=tincanrelaunch_attempt-]',\n        REGISTRATION: '#launchform_registration',\n        STATUS: '#tincanlaunch_status',\n        STATUSPARA: '#tincanlaunch_status_para'\n    };\n\n    var Launch = {\n        init: function() {\n            var self = this;\n\n            // Retrieve id and n URL parameters\n            var urlparams = new URLSearchParams(window.location.search);\n            self.id = urlparams.get('id');\n            self.n = urlparams.get('n');\n\n            // Iterate over table registrations and add necessary values.\n            $(SELECTORS.REATTEMPT).each(function() {\n                var registrationid = $(this).attr('id').substring(23);\n\n                // Listen for keyUp event.\n                $(this).keyup(function(e) {\n                    self.keyTest(e.keyCode, registrationid);\n                });\n\n                // Listen for click event.\n                $(this).click(function() {\n                    self.launchExperience(registrationid);\n                });\n\n                // Add tabindex and cursor.\n                $(this).attr('tabindex', '0');\n                $(this).attr('style', 'cursor: pointer');\n            });\n\n            // Add details to new attempt link.\n            var newregistrationid = $(SELECTORS.NEW_ATTEMPT_LINK).attr('id').substring(28);\n            $(SELECTORS.NEW_ATTEMPT_LINK).attr('tabindex', '0');\n            $(SELECTORS.NEW_ATTEMPT_LINK).attr('style', 'cursor: pointer');\n\n            $(SELECTORS.NEW_ATTEMPT_LINK).click(function() {\n                self.launchExperience(newregistrationid);\n            });\n\n            $(SELECTORS.NEW_ATTEMPT_LINK).keyup(function(e) {\n                self.keyTest(e.keyCode, newregistrationid);\n            });\n\n            // Periodically check completion\n            // TODO: Fix this.\n            setInterval(function() {\n                $(SELECTORS.COMPLETION_CHECK).load('completion_check.php?id=' + id + '&n=' + n);\n            }, 30000); // TODO: make this interval a configuration setting.\n        },\n        keyTest: function(keycode, registrationid) {\n            var self = this;\n            if (keycode === 13 || keycode === 32) {\n                self.launchExperience(registrationid);\n            }\n        },\n        launchExperience: function(registrationid) {\n            var self = this;\n            var stringsToRetrieve = [\n                {\n                    key: 'tincanlaunch_progress',\n                    component: 'tincanlaunch'\n                },\n                {\n                    key: 'returntocourse',\n                    component: 'tincanlaunch'\n                }\n            ];\n            $(SELECTORS.REGISTRATION).val(registrationid);\n            $(SELECTORS.LAUNCH_FORM).submit();\n            $(SELECTORS.NEW_ATTEMPT).remove();\n            $(SELECTORS.ATTEMPT_TABLE).remove();\n\n            Str.get_strings(stringsToRetrieve)\n                .done(function(s) {\n                    $(SELECTORS.STATUSPARA).text(s[0]);\n\n                    var exitpara = $(\"<p>\").attr(\"id\", SELECTORS.EXIT);\n                    exitpara.html(\"<a href='complete.php?id=\" + self.id + \"&n=\" + self.n + \"'>\" + s[1] + \"</a>\");\n                    $(SELECTORS.STATUSPARA).after(exitpara);\n                });\n        }\n\n    };\n\n    return Launch;\n});"],"file":"launch.min.js"}