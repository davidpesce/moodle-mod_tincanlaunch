{"version":3,"sources":["../src/launch.js"],"names":["define","$","Str","id","n","SELECTORS","ATTEMPT_PROGRESS","ATTEMPT_TABLE","COMPLETION_CHECK","EXIT","LAUNCH_FORM","MAINCONTENT","NEW_ATTEMPT","NEW_ATTEMPT_LINK","REATTEMPT","REGISTRATION","STATUSDIV","STATUSPARA","init","self","urlparams","URLSearchParams","window","location","search","get","each","registrationid","attr","substring","keyup","e","keyTest","keyCode","click","launchExperience","newregistrationid","statuspara","completionspan","append","setInterval","load","keycode","val","submit","remove","get_strings","key","component","done","s","text","exitpara","html","after"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handles display of the launch attempt table (registrations).\n *\n * @package   mod_tincanlaunch\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    David Pesce  (david.pesce [at] exputo [dt] com)\n\n * @module mod_tincanlaunch/launch\n*/\n\ndefine(['jquery', 'core/str'], function($, Str) {\n\n    var id = '';\n    var n = '';\n\n    var SELECTORS = {\n        ATTEMPT_PROGRESS: '#tincanlaunch_attemptprogress',\n        ATTEMPT_TABLE: '#tincanlaunch_attempttable',\n        COMPLETION_CHECK: '#tincanlaunch_completioncheck',\n        EXIT: '#tincanlaunch_exit',\n        LAUNCH_FORM: '#launchform',\n        MAINCONTENT: '#maincontent',\n        NEW_ATTEMPT: '#tincanlaunch_newattempt',\n        NEW_ATTEMPT_LINK: '[id^=tincanlaunch_newattemptlink-]',\n        REATTEMPT: '[id^=tincanrelaunch_attempt-]',\n        REGISTRATION: '#launchform_registration',\n        STATUSDIV: '#tincanlaunch_status',\n        STATUSPARA: '#tincanlaunch_status_para'\n    };\n\n    var Launch = {\n        init: function() {\n            var self = this;\n\n            // Retrieve id and n URL parameters\n            var urlparams = new URLSearchParams(window.location.search);\n            id = urlparams.get('id');\n            n = urlparams.get('n');\n\n            // Iterate over table registrations and add necessary values.\n            $(SELECTORS.REATTEMPT).each(function() {\n                var registrationid = $(this).attr('id').substring(23);\n\n                // Listen for keyUp event.\n                $(this).keyup(function(e) {\n                    self.keyTest(e.keyCode, registrationid);\n                });\n\n                // Listen for click event.\n                $(this).click(function() {\n                    self.launchExperience(registrationid);\n                });\n\n                // Add tabindex and cursor.\n                $(this).attr('tabindex', '0');\n                $(this).attr('style', 'cursor: pointer');\n            });\n\n            // Add details to new attempt link.\n            var newregistrationid = $(SELECTORS.NEW_ATTEMPT_LINK).attr('id').substring(28);\n            $(SELECTORS.NEW_ATTEMPT_LINK).attr('tabindex', '0');\n            $(SELECTORS.NEW_ATTEMPT_LINK).attr('style', 'cursor: pointer');\n\n            $(SELECTORS.NEW_ATTEMPT_LINK).click(function() {\n                self.launchExperience(newregistrationid);\n            });\n\n            $(SELECTORS.NEW_ATTEMPT_LINK).keyup(function(e) {\n                self.keyTest(e.keyCode, newregistrationid);\n            });\n\n            // Add status para.\n            var statuspara = $(\"<p></p>\").attr(\"id\", \"tincanlaunch_status_para\");\n\n            // Add completion span.\n            var completionspan = $(\"<span>\").attr(\"id\", \"tincanlaunch_completioncheck\");\n            $(SELECTORS.STATUSDIV).append(statuspara, completionspan);\n\n            // Periodically check completion\n            setInterval(function() {\n                $(SELECTORS.COMPLETION_CHECK).load('completion_check.php?id=' + id + '&n=' + n);\n            }, 30000); // TODO: make this interval a configuration setting.\n        },\n        keyTest: function(keycode, registrationid) {\n            var self = this;\n            if (keycode === 13 || keycode === 32) {\n                self.launchExperience(registrationid);\n            }\n        },\n        launchExperience: function(registrationid) {\n            var stringsToRetrieve = [\n                {\n                    key: 'tincanlaunch_progress',\n                    component: 'tincanlaunch'\n                },\n                {\n                    key: 'returntocourse',\n                    component: 'tincanlaunch'\n                }\n            ];\n            $(SELECTORS.REGISTRATION).val(registrationid);\n            $(SELECTORS.LAUNCH_FORM).submit();\n            $(SELECTORS.NEW_ATTEMPT).remove();\n            $(SELECTORS.ATTEMPT_TABLE).remove();\n\n            Str.get_strings(stringsToRetrieve)\n                .done(function(s) {\n                    // Attempt in progress.\n                    $(SELECTORS.STATUSPARA).text(s[0]);\n\n                    // Return to course.\n                    var exitpara = $(\"<p></p>\").attr(\"id\", SELECTORS.EXIT);\n                    exitpara.html(\"<a href='complete.php?id=\" + id + \"&n=\" + n + \"'>\" + s[1] + \"</a>\");\n                    $(SELECTORS.STATUSPARA).after(exitpara);\n            });\n        }\n\n    };\n\n    return Launch;\n});"],"file":"launch.min.js"}